<script>

const estrutura={
"üîπ DOCUMENTOS OBRIGAT√ìRIOS":[
"Curr√≠culo atualizado","01 Foto 3x4","CTPS Digital","RG ‚Äì Frente e Verso","CPF",
"T√≠tulo de Eleitor","Comprovante de Resid√™ncia Atual",
"Certificado de Dispensa de Incorpora√ß√£o (Reservista)",
"Cart√£o PIS + Consulta de Qualifica√ß√£o Cadastral",
"Comprovante de Situa√ß√£o Cadastral do CPF",
"Atestado de Antecedentes Criminais (Original)",
"Conta Banc√°ria ‚Äì Bradesco ou Next",
"Certificados de Cursos Profissionalizantes",
"CNH (quando aplic√°vel √† fun√ß√£o)",
"Exame Toxicol√≥gico (para fun√ß√£o motorista)",
"Curso de Dire√ß√£o Defensiva (para fun√ß√£o motorista)",
"Curso de Primeiros Socorros (para fun√ß√£o motorista)",
"Cart√£o de Vacina","Atestado M√©dico Admissional"
],
"üîπ DOCUMENTOS OPCIONAIS / CONDICIONAIS":{
"üìö Escolaridade":[
"Ensino Fundamental","Ensino M√©dio","Ensino Superior",
"P√≥s-Gradua√ß√£o","Mestrado","Doutorado"
],
"üèõ Registro Profissional":[
"Registro Profissional (quando profiss√£o regulamentada)",
"Registro Profissional Pendente"
],
"üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Dependentes":[
"RG e CPF do C√¥njuge","Certid√£o de Casamento / Uni√£o Est√°vel",
"RG e CPF dos Filhos","Cart√£o de Vacina dos Filhos",
"Declara√ß√£o Escolar dos Filhos"
]
}
};

let checklist = {};
let matriculaAtual = null;

function baseChecklist(){
let base={};
Object.values(estrutura).forEach(sec=>{
if(Array.isArray(sec)){
sec.forEach(i=>base[i]=false);
}else{
Object.values(sec).forEach(sub=>{
sub.forEach(i=>base[i]=false);
});
}
});
return base;
}

function salvarNoStorage(){
if(!matriculaAtual) return;
localStorage.setItem("func_"+matriculaAtual, JSON.stringify(checklist));
}

function carregarFuncionario(){
const m=document.getElementById("matricula").value.trim();
const n=document.getElementById("nome").value.trim();

if(!m){
alert("Informe a matr√≠cula.");
return;
}

matriculaAtual = m;

const dados = localStorage.getItem("func_"+m);

if(dados){
checklist = JSON.parse(dados);
}else{
checklist = baseChecklist();
salvarNoStorage();
}

render();
}

function toggle(item){
checklist[item]=!checklist[item];
salvarNoStorage();
atualizarProgresso();
render();
}

function render(){
const container=document.getElementById("checklist");
container.innerHTML="";

Object.entries(estrutura).forEach(([sec,cont])=>{
container.innerHTML+=`<div class="section-title">${sec}</div>`;
if(Array.isArray(cont)){
lista(cont,container);
}else{
Object.entries(cont).forEach(([sub,it])=>{
container.innerHTML+=`<div class="sub-title">${sub}</div>`;
lista(it,container);
});
}
});
atualizarProgresso();
}

function lista(itens,container){
const ul=document.createElement("ul");
itens.forEach(item=>{
const li=document.createElement("li");
if(checklist[item]) li.classList.add("completed");
li.innerHTML=`
<input type="checkbox" ${checklist[item]?"checked":""}
onchange="toggle('${item.replace(/'/g,"")}')">
<label>${item}</label>`;
ul.appendChild(li);
});
container.appendChild(ul);
}

function atualizarProgresso(){
const total=Object.keys(checklist).length;
const ok=Object.values(checklist).filter(v=>v).length;
const perc = total ? (ok/total)*100 : 0;
document.getElementById("progress").style.width=perc+"%";
document.getElementById("stats").innerText=`${ok} de ${total} conclu√≠dos`;
}

function resetar(){
if(!matriculaAtual) return;
checklist = baseChecklist();
salvarNoStorage();
render();
}

function relatorio(){
let txt=`CHECKLIST ADMISSIONAL\n\n`;
txt+=`Matr√≠cula: ${matriculaAtual}\n`;
txt+=`Nome: ${document.getElementById("nome").value}\n\n`;

Object.entries(checklist).forEach(([doc,status])=>{
txt+=`[${status?"OK":"PENDENTE"}] ${doc}\n`;
});

return txt;
}

function copiar(){
navigator.clipboard.writeText(relatorio());
alert("Relat√≥rio copiado!");
}

function exportar(){
const blob=new Blob([relatorio()],{type:"text/plain"});
const link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="checklist_"+matriculaAtual+".txt";
link.click();
}

</script>
